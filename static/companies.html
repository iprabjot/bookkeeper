<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bookkeeper - Companies</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link rel="alternate icon" href="/static/favicon.ico">
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1> Bookkeeper</h1>
            <nav>
                <a href="index.html">Dashboard</a>
                <a href="invoices.html">Invoices</a>
                <a href="bank-statements.html">Bank Statements</a>
                <a href="reports.html">Reports</a>
                <a href="companies.html" class="active">Companies</a>
                <a href="vendors.html">Vendors</a>
                <a href="buyers.html">Buyers</a>
            </nav>
        </header>

        <main>
            <h2>Companies</h2>
            
            <div class="form-section" style="margin-bottom: 30px;">
                <h3>Create New Company</h3>
                <form id="company-form" onsubmit="createCompany(event)">
                    <div class="form-group">
                        <label>Company Name</label>
                        <input type="text" id="company-name" required>
                    </div>
                    <div class="form-group">
                        <label>GSTIN</label>
                        <input type="text" id="company-gstin" required>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="company-current"> Set as current company
                        </label>
                    </div>
                    <button type="submit" class="btn btn-primary">Create Company</button>
                </form>
                <div id="company-message"></div>
            </div>

            <div class="companies-list">
                <h3>All Companies</h3>
                <div id="companies-loading" class="loading">Loading companies...</div>
                <div id="companies-error" class="error" style="display: none;"></div>
                <table id="companies-table" style="display: none;">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>GSTIN</th>
                            <th>Current</th>
                            <th>Created</th>
                        </tr>
                    </thead>
                    <tbody id="companies-tbody"></tbody>
                </table>
            </div>
        </main>
    </div>

    <script src="/static/api.js"></script>
    <script>
        async function createCompany(event) {
            event.preventDefault();
            
            const name = document.getElementById('company-name').value;
            const gstin = document.getElementById('company-gstin').value;
            const isCurrent = document.getElementById('company-current').checked;
            const messageEl = document.getElementById('company-message');
            
            try {
                await window.createCompany({ name, gstin, is_current: isCurrent });
                messageEl.innerHTML = '<div class="success"> Company created successfully!</div>';
                document.getElementById('company-form').reset();
                loadCompanies();
            } catch (error) {
                messageEl.innerHTML = `<div class="error"> Error: ${error.message}</div>`;
            }
        }
        
        async function loadCompanies() {
            const loadingEl = document.getElementById('companies-loading');
            const errorEl = document.getElementById('companies-error');
            const tableEl = document.getElementById('companies-table');
            const tbodyEl = document.getElementById('companies-tbody');
            
            try {
                const companies = await window.getCompanies();
                
                if (companies.length === 0) {
                    tbodyEl.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 40px;">No companies found</td></tr>';
                } else {
                    tbodyEl.innerHTML = companies.map(company => {
                        const date = new Date(company.created_at).toLocaleDateString('en-IN');
                        const currentBadge = company.is_current ? '<span class="badge badge-paid">Current</span>' : '';
                        
                        return `
                            <tr>
                                <td><strong>${company.name}</strong></td>
                                <td>${company.gstin}</td>
                                <td>${currentBadge}</td>
                                <td>${date}</td>
                            </tr>
                        `;
                    }).join('');
                }
                
                loadingEl.style.display = 'none';
                tableEl.style.display = 'table';
            } catch (error) {
                loadingEl.style.display = 'none';
                errorEl.style.display = 'block';
                errorEl.textContent = `Error loading companies: ${error.message}`;
            }
        }
        
        document.addEventListener('DOMContentLoaded', loadCompanies);
    </script>
</body>
</html>

